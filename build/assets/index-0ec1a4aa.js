import{r as i,as as S,j as e,ax as u}from"./index-e9055987.js";import{C as M}from"./circle-plus-d9b5bf80.js";import{X as I}from"./x-663813fb.js";import{P as _}from"./pencil-7983d55c.js";import{T as q}from"./trash-2-8957055b.js";import"./createLucideIcon-35c01f3b.js";const c={getAttributes:async()=>{const{data:a,error:r}=await u.from("attributes").select(`
        id,
        name,
        created_at,
        values:attribute_values (id, value, created_at)
      `);if(r)throw r;return a||[]},createAttribute:async(a,r)=>{const{data:n,error:o}=await u.from("attributes").upsert({name:a,shop_id:r}).select("*").single();if(o)throw o;return{...n,values:[]}},updateAttribute:async(a,r)=>{const{data:n,error:o}=await u.from("attributes").update({name:r}).select("*").eq("id",a).single();if(o)throw o;return console.log(n),n},deleteAttribute:async a=>{const{error:r}=await u.from("attributes").delete().eq("id",a);if(r)throw r},createAttributeValue:async(a,r)=>{const{data:n,error:o}=await u.from("attribute_values").upsert({type:a,value:r}).select("*").single();if(o)throw o;return n},deleteAttributeValue:async(a,r)=>{const{error:n}=await u.from("attribute_values").delete().eq("id",r).eq("type",a);if(n)throw n}};function R(){const[a,r]=i.useState([]),[n,o]=i.useState(!1),[y,x]=i.useState(!1),[p,v]=i.useState(null),[d,m]=i.useState(""),[h,f]=i.useState(""),[g,b]=i.useState(""),N=S(t=>t.auth.user);i.useEffect(()=>{w()},[]);const w=async()=>{const t=await c.getAttributes();r(t)},j=async()=>{if(d.trim())try{const t=await c.createAttribute(d,N.shopId);r([...a,t]),m(""),o(!1)}catch{b("Error creando el atributo. Intenta de nuevo.")}},A=async()=>{if(p&&d.trim())try{const t=await c.updateAttribute(p.id,d);r(a.map(s=>s.id===t.id?t:s)),m(""),x(!1)}catch{b("Error actualizando el atributo. Intenta de nuevo.")}},C=async t=>{var s;try{(s=a.find(l=>l.id===t))==null||s.values.map(async l=>{await c.deleteAttributeValue(t,l.id)}),await c.deleteAttribute(t),r(a.filter(l=>l.id!==t))}catch{b("Error eliminando el atributo. Intenta de nuevo.")}},k=async t=>{if(h.trim())try{const s=await c.createAttributeValue(t,h);r(a.map(l=>l.id===t?{...l,values:[...l.values,s]}:l)),f("")}catch{b("Error creando el valor del atributo. Intenta de nuevo.")}},E=async(t,s)=>{try{await c.deleteAttributeValue(t,s),r(a.map(l=>l.id===t?{...l,values:l.values.filter(V=>V.id!==s)}:l))}catch{b("Error eliminando el valor del atributo. Intenta de nuevo.")}};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Gestor de Atributos"}),g&&e.jsx("div",{className:"mb-4 text-red-600",children:g}),e.jsxs("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-4",onClick:()=>o(!0),children:[e.jsx(M,{className:"inline-block mr-2"}),"Crear Atributo"]}),e.jsxs("table",{className:"min-w-full bg-white border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"py-2 px-4 border-b text-left",children:"ID"}),e.jsx("th",{className:"py-2 px-4 border-b text-left",children:"Nombre"}),e.jsx("th",{className:"py-2 px-4 border-b text-left",children:"Valores"}),e.jsx("th",{className:"py-2 px-4 border-b text-left",children:"Acciones"})]})}),e.jsx("tbody",{children:a.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-4 border-b",children:t.id}),e.jsx("td",{className:"py-2 px-4 border-b",children:t.name}),e.jsxs("td",{className:"py-2 px-4 border-b",children:[t.values.map(s=>e.jsxs("span",{className:"inline-block bg-gray-200 rounded-full px-3 py-1 text-sm font-semibold text-gray-700 mr-2 mb-2",children:[s.value,e.jsx("button",{onClick:()=>E(t.id,s.id),className:"ml-2 text-red-500 hover:text-red-700",children:e.jsx(I,{className:"inline-block w-4 h-4"})})]},s.id)),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),k(t.id)},className:"inline-block",children:[e.jsx("input",{type:"text",value:h,onChange:s=>f(s.target.value),className:"border rounded px-2 py-1 text-sm",placeholder:"Nuevo valor"}),e.jsx("button",{type:"submit",className:"ml-2 bg-green-500 hover:bg-green-700 text-white font-bold py-1 px-2 rounded text-sm",children:"Agregar"})]})]}),e.jsxs("td",{className:"py-2 px-4 border-b",children:[e.jsx("button",{onClick:()=>{v(t),m(t.name),x(!0)},className:"text-blue-500 hover:text-blue-700 mr-2",children:e.jsx(_,{className:"inline-block"})}),e.jsx("button",{onClick:()=>C(t.id),className:"text-red-500 hover:text-red-700",children:e.jsx(q,{className:"inline-block"})})]})]},t.id))})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Crear Nuevo Atributo"}),e.jsx("div",{className:"mt-2 px-7 py-3",children:e.jsx("input",{type:"text",value:d,onChange:t=>m(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-300",placeholder:"Nombre del atributo"})}),e.jsxs("div",{className:"items-center px-4 py-3",children:[e.jsx("button",{onClick:j,className:"px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Crear"}),e.jsx("button",{onClick:()=>o(!1),className:"mt-3 px-4 py-2 bg-gray-300 text-gray-800 text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Cancelar"})]})]})})}),y&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Editar Atributo"}),e.jsx("div",{className:"mt-2 px-7 py-3",children:e.jsx("input",{type:"text",value:d,onChange:t=>m(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-300",placeholder:"Nombre del atributo"})}),e.jsxs("div",{className:"items-center px-4 py-3",children:[e.jsx("button",{onClick:A,className:"px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Actualizar"}),e.jsx("button",{onClick:()=>x(!1),className:"mt-3 px-4 py-2 bg-gray-300 text-gray-800 text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Cancelar"})]})]})})})]})}export{R as default};
