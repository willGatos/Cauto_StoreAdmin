import{ap as M,aq as I,b2 as y,ar as q,as as N,j as t,r as c,a as f,g as k,at as B}from"./index-e9055987.js";import{k as H,l as K}from"./SalesService-3d09fa59.js";import{A}from"./AdaptableCard-459786db.js";import{T as b}from"./index-95867d9f.js";import{u as j,g as D,e as F,f as m}from"./index-f0b8471c.js";import{a3 as P,a4 as Z,C as U,a1 as z,U as V}from"./index.esm-1ac4f407.js";import{B as C}from"./Button-ba65fcd6.js";import{I as $}from"./Input-cff490ba.js";import{d as G}from"./debounce-85f84bbc.js";import{c as J}from"./cloneDeep-860e24f8.js";import{t as Q,N as W}from"./toast-38b8809c.js";import{C as X}from"./ConfirmDialog-d3517bf8.js";import"./Card-433b6df5.js";import"./Views-51136580.js";import"./isNil-1a93575e.js";import"./get-c3140d19.js";import"./_MapCache-0feb66c1.js";import"./_Uint8Array-1ce16692.js";import"./_getPrototype-241bf201.js";import"./StatusIcon-879e2680.js";import"./CloseButton-3f8e850c.js";import"./motion-4061acbd.js";import"./index-48bcc748.js";import"./Tooltip-c9ef7fc2.js";import"./warning-6ee4a779.js";import"./index-8f83c5d8.js";import"./Dialog-0f29b530.js";import"./index-1248b5e2.js";const S="salesOrderList",h=M(S+"/getOrders",async e=>(await H(e)).data),w=async e=>(await K(e)).data,Y={loading:!1,orderList:[],tableData:{total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},selectedRows:[],selectedRow:"",deleteMode:""},O=I({name:`${S}/state`,initialState:Y,reducers:{setOrderList:(e,s)=>{e.orderList=s.payload},setTableData:(e,s)=>{e.tableData=s.payload},setSelectedRows:(e,s)=>{e.selectedRows=s.payload},setSelectedRow:(e,s)=>{e.selectedRow=s.payload},addRowItem:(e,{payload:s})=>{const l=y(e);l.selectedRows.includes(s)||(e.selectedRows=[...l.selectedRows,...s])},removeRowItem:(e,{payload:s})=>{const l=y(e);l.selectedRows.includes(s)&&(e.selectedRows=l.selectedRows.filter(r=>r!==s))},setDeleteMode:(e,s)=>{e.deleteMode=s.payload}},extraReducers:e=>{e.addCase(h.fulfilled,(s,l)=>{s.orderList=l.payload.data,s.tableData.total=l.payload.total,s.loading=!1}).addCase(h.pending,s=>{s.loading=!0})}}),{setOrderList:Pe,setTableData:ee,setSelectedRows:te,setSelectedRow:R,addRowItem:Ze,removeRowItem:Ue,setDeleteMode:g}=O.actions,se=O.reducer,ae=q({data:se}),u=N,re={getOrders:()=>Promise.resolve([{id:1,total:150,status:"Pendiente",created_at:"2023-05-15T10:30:00Z",shipping_cost:10,seller_id:1,amount_paid:0,items:[{id:1,quantity:2,price:70,variation:{id:1,product_id:1,name:"Camiseta Roja - Talla M",price:35,stock:50,created_at:"2023-05-10T09:00:00Z",thumbnail:"/placeholder.svg?height=50&width=50",pictures:["/placeholder1.svg","/placeholder2.svg"],currency:{id:1,name:"USD"},attributes:[{id:1,attribute_id:1,value:"Rojo"},{id:2,attribute_id:2,value:"M"}],supplies:[{id:1,supply_id:1,quantity:2},{id:2,supply_id:2,quantity:1}]}},{id:2,quantity:1,price:80,variation:{id:2,product_id:2,name:"Pantalón Negro - Talla 32",price:80,stock:30,created_at:"2023-04-20T09:00:00Z",thumbnail:"/placeholder.svg?height=50&width=50",pictures:["/placeholder1.svg","/placeholder2.svg"],currency:{id:1,name:"USD"},attributes:[{id:1,attribute_id:3,value:"Negro"},{id:2,attribute_id:4,value:"32"}],supplies:[{id:1,supply_id:3,quantity:3},{id:2,supply_id:4,quantity:1}]}}]},{id:2,total:200,status:"En Proceso",created_at:"2023-05-16T14:45:00Z",shipping_cost:15,seller_id:2,amount_paid:50,items:[{id:3,quantity:1,price:185,variation:{id:3,product_id:3,name:"Zapatos Deportivos - Talla 39",price:185,stock:20,created_at:"2023-03-15T09:00:00Z",thumbnail:"/placeholder.svg?height=50&width=50",pictures:["/placeholder1.svg","/placeholder2.svg"],currency:{id:1,name:"USD"},attributes:[{id:1,attribute_id:5,value:"Blanco"},{id:2,attribute_id:6,value:"39"}],supplies:[{id:1,supply_id:5,quantity:2}]}}]}])},{Tr:p,Th:T,Td:x,THead:_,TBody:v}=b;function oe({RenderRowSubComponent:e,getRowCanExpand:s}){const[l,r]=c.useState([]);c.useEffect(()=>{re.getOrders().then(r)},[]);const n=c.useMemo(()=>[{header:()=>null,id:"expander",cell:({row:o})=>t.jsx(t.Fragment,{children:o.getCanExpand()?t.jsx("button",{className:"text-lg",onClick:o.getToggleExpandedHandler(),children:o.getIsExpanded()?t.jsx(P,{}):t.jsx(Z,{})}):null}),subCell:()=>null},{header:"ID",accessorKey:"id"},{header:"Cliente",accessorKey:"client.user.name"},{header:"Teléfono",accessorKey:"client.user.phone"},{header:"Estado",accessorKey:"status"},{header:"Total",accessorKey:"total",cell:({row:o})=>L(o.original.total)},{header:"Fecha",accessorKey:"created_at",cell:({row:o})=>le(o.original.created_at)}],[]),d=j({data:l,columns:n,getRowCanExpand:s,getCoreRowModel:D(),getExpandedRowModel:F()});return t.jsxs(b,{children:[t.jsx(_,{children:d.getHeaderGroups().map(o=>t.jsx(p,{children:o.headers.map(a=>t.jsx(T,{colSpan:a.colSpan,children:m(a.column.columnDef.header,a.getContext())},a.id))},o.id))}),t.jsx(v,{children:d.getRowModel().rows.map(o=>t.jsxs(c.Fragment,{children:[t.jsx(p,{children:o.getVisibleCells().map(a=>t.jsx(x,{children:m(a.column.columnDef.cell,a.getContext())},a.id))}),o.getIsExpanded()&&t.jsx(p,{children:t.jsx(x,{colSpan:o.getVisibleCells().length,children:t.jsx(e,{row:o})})})]},o.id))})]})}function ie({row:e}){const s=c.useMemo(()=>[{header:"Producto",accessorKey:"variation.name"},{header:"Cantidad",accessorKey:"quantity"},{header:"Precio",accessorKey:"price",cell:({row:r})=>L(r.original.price)}],[]),l=j({data:e.original.items,columns:s,getCoreRowModel:D()});return t.jsxs(b,{children:[t.jsx(_,{children:l.getHeaderGroups().map(r=>t.jsx(p,{children:r.headers.map(n=>t.jsx(T,{colSpan:n.colSpan,children:m(n.column.columnDef.header,n.getContext())},n.id))},r.id))}),t.jsx(v,{children:l.getRowModel().rows.map(r=>t.jsx(p,{children:r.getVisibleCells().map(n=>t.jsx(x,{children:m(n.column.columnDef.cell,n.getContext())},n.id))},r.id))})]})}const le=e=>new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),L=e=>new Intl.NumberFormat("es-ES",{style:"currency",currency:"USD"}).format(e);function ne(){return t.jsx(oe,{RenderRowSubComponent:ie,getRowCanExpand:()=>!0})}const de=()=>{const e=f(),s=c.useRef(null),l=u(a=>a.salesOrderList.data.tableData),r=G(n,500);function n(a){const i=J(l);i.query=a,i.pageIndex=1,typeof a=="string"&&a.length>1&&d(i),typeof a=="string"&&a.length===0&&d(i)}const d=a=>{e(ee(a)),e(h(a))},o=a=>{r(a.target.value)};return t.jsx($,{ref:s,className:"lg:w-52",size:"sm",placeholder:"Search",prefix:t.jsx(U,{className:"text-lg"}),onChange:o})},ce=()=>{const e=f(),s=()=>{e(g("batch"))};return t.jsx(C,{variant:"solid",color:"red-600",size:"sm",icon:t.jsx(V,{}),onClick:s,children:"Batch Delete"})},ue=()=>{const e=u(s=>s.salesOrderList.data.selectedRows);return t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4",children:[e.length>0&&t.jsx(ce,{}),t.jsx(k,{download:!0,to:"/data/order-list.csv",target:"_blank",children:t.jsx(C,{block:!0,size:"sm",icon:t.jsx(z,{}),children:"Export"})}),t.jsx(de,{})]})},pe=()=>{const e=f(),s=u(i=>i.salesOrderList.data.selectedRows),l=u(i=>i.salesOrderList.data.selectedRow),r=u(i=>i.salesOrderList.data.deleteMode),n=u(i=>i.salesOrderList.data.tableData),d=()=>{e(g("")),r==="single"&&e(R([]))},o=async()=>{if(e(g("")),r==="single"){const i=await w({id:l});a(i),e(R([]))}if(r==="batch"){const i=await w({id:s});a(i,s.length),e(te([]))}},a=(i,E=0)=>{i&&(e(h(n)),Q.push(t.jsxs(W,{title:"Successfuly Deleted",type:"success",duration:2500,children:[r==="single"&&"Order ",r==="batch"&&`${E} orders `,"successfuly deleted"]}),{placement:"top-center"}))};return t.jsx(X,{isOpen:r==="single"||r==="batch",type:"danger",title:"Delete product",confirmButtonColor:"red-600",onClose:d,onRequestClose:d,onCancel:d,onConfirm:o,children:t.jsx("p",{children:"Are you sure you want to delete this order? All record related to this order will be deleted as well. This action cannot be undone."})})};B("salesOrderList",ae);const me=()=>t.jsxs(A,{className:"h-full",bodyClass:"h-full",children:[t.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"mb-4 lg:mb-0",children:"Orders"}),t.jsx(ue,{})]}),t.jsx(ne,{}),t.jsx(pe,{})]}),ze=me;export{ze as default};
