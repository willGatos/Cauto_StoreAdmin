import{j as e,w as $,r as M,c as v}from"./index-e9055987.js";import{T as z}from"./Tag-0c9ab60f.js";import{d as W,B as f}from"./Button-ba65fcd6.js";import{t as J,N as L}from"./toast-38b8809c.js";import{F as U,a as g}from"./FormItem-ea0b05bc.js";import{u as O,D as _}from"./Dialog-0f29b530.js";import{F as w,a as H}from"./FormRow-164095a5.js";import{I as G}from"./Input-cff490ba.js";import{u as K,T as Q}from"./Tooltip-c9ef7fc2.js";import{C as X}from"./index-0b16cfb5.js";import{a as Z,u as ee}from"./useControllableState-461bebfa.js";import{u as re}from"./useDidUpdate-5adca6d0.js";import{a as te,u as se}from"./useRootClose-9a8a5c26.js";import{u as ae}from"./StatusIcon-879e2680.js";import{u as ie}from"./useUncertainRef-63de6025.js";import{F as A,a as B,b as j}from"./formik.esm-026afa26.js";import{au as oe,P as ne,ac as le,av as de}from"./index.esm-1ac4f407.js";import{F as D,a as me}from"./FormPatternInput-8dff4752.js";import{c as ce,a as T,e as pe}from"./index.esm-6e43d029.js";import{T as P}from"./index-95867d9f.js";import{B as ue}from"./Badge-9568a8b0.js";import{c as xe,u as he,g as ge,f as S}from"./index-f0b8471c.js";import{N as fe}from"./react-number-format.es-1ce1616c.js";import{i as V}from"./isLastChild-83eb4c23.js";import{b as je}from"./index-92d9b20b.js";import"./CloseButton-3f8e850c.js";import"./motion-4061acbd.js";import"./index-8f83c5d8.js";import"./index-1248b5e2.js";import"./warning-6ee4a779.js";import"./Views-51136580.js";import"./isNil-1a93575e.js";import"./get-c3140d19.js";import"./_MapCache-0feb66c1.js";import"./cloneDeep-860e24f8.js";import"./_Uint8Array-1ce16692.js";import"./_getPrototype-241bf201.js";import"./_baseIsEqual-7de73e16.js";import"./index-470afdad.js";import"./AdaptableCard-459786db.js";import"./Card-433b6df5.js";const be={useCallbackRef:Z,useColorLevel:W,useControllableState:ee,useDidUpdate:re,useMergeRef:K,useRootClose:te,useTimeout:ae,useUncertainRef:ie,useUniqueId:se,useWindowSize:O},{useUniqueId:ye}=be,Ne=ce().shape({cardHolderName:T().required("Card holder name required"),ccNumber:T().required("Credit card number required").matches(/^(?:4[0-9]{12}(?:[0-9]{3})?|[25][1-7][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/,"Invalid credit card number"),cardExpiry:T().required("Card holder name required").matches(/^(0[1-9]|1[0-2])\/?([0-9]{4}|[0-9]{2})$/,"Invalid Date"),code:T().required().matches(/^[0-9]{3}$/,"Invalid CVV"),primary:pe()});function R(r,s){return r.length===1&&r[0]>s[0]&&(r="0"+r),r.length===2&&(Number(r)===0?r="01":r>s&&(r=s)),r}function Ce(r){const s=R(r.substring(0,2),"12"),h=R(r.substring(2,4),"31");return s+(h.length?"/"+h:"")}const Me=({card:r,type:s,onUpdate:h})=>{const u=ye("cc-"),l=p=>{const{cardHolderName:d,ccNumber:m,cardExpiry:a,primary:x}=p;if(r){const{cardType:I,cardId:E}=r;let t={cardId:"",cardType:"",last4Number:m.substr(m.length-4),expYear:a.substr(a.length-2),expMonth:a.substring(0,2),cardHolderName:d,primary:x};s==="EDIT"&&(t={...t,cardId:E,cardType:I}),s==="NEW"&&(t={...t,cardId:u,cardType:"VISA"}),console.log("updatedCard",t),h(t)}};return e.jsx(A,{initialValues:{cardHolderName:(r==null?void 0:r.cardHolderName)||"",ccNumber:"",cardExpiry:(r==null?void 0:r.expMonth)+(r==null?void 0:r.expYear)||"",code:"",primary:(r==null?void 0:r.primary)||!1},validationSchema:Ne,onSubmit:(p,{setSubmitting:d})=>{l(p),d(!1)},children:({touched:p,errors:d})=>e.jsx(B,{children:e.jsxs(U,{children:[e.jsx(g,{label:"Card holder name",invalid:d.cardHolderName&&p.cardHolderName,errorMessage:d.cardHolderName,children:e.jsx(j,{type:"text",autoComplete:"off",name:"cardHolderName",component:G})}),e.jsx(g,{label:"Credit Card Number",invalid:d.ccNumber&&p.ccNumber,errorMessage:d.ccNumber,children:e.jsx(j,{name:"ccNumber",children:({field:m,form:a})=>e.jsx(D,{form:a,field:m,placeholder:"•••• •••• •••• ••••",format:"#### #### #### ####",inputSuffix:e.jsx(oe,{className:"text-lg"}),onValueChange:x=>{a.setFieldValue(m.name,x.value)}})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(g,{label:"Expiration date",invalid:d.cardExpiry&&p.cardExpiry,errorMessage:d.cardExpiry,children:e.jsx(j,{name:"cardExpiry",children:({field:m,form:a})=>e.jsx(me,{form:a,field:m,placeholder:"••/••",inputSuffix:e.jsx(ne,{className:"text-lg"}),format:Ce,defaultValue:a.values.cardExpiry,onValueChange:x=>{a.setFieldValue(m.name,x.value)}})})}),e.jsx(g,{label:"CVV",invalid:d.code&&p.code,errorMessage:d.code,children:e.jsx(j,{name:"code",children:({field:m,form:a})=>e.jsx(D,{form:a,field:m,placeholder:"•••",format:"###",inputPrefix:e.jsx(Q,{title:"The CVV/CVC code is located on the back of your credit/debit card on the right side of the white signature strip",children:e.jsx(le,{className:"cursor-pointer text-lg"})}),onValueChange:x=>{a.setFieldValue(m.name,x.value)}})})})]}),e.jsx(g,{children:e.jsx(j,{name:"primary",component:X,children:"Set this card as primary"})}),e.jsx(g,{className:"mb-0 text-right",children:e.jsx(f,{block:!0,variant:"solid",type:"submit",children:"Update"})})]})})})},{Tr:q,Th:Te,Td:Ie,THead:Ee,TBody:Fe}=P,ke={paid:"bg-emerald-500",pending:"bg-amber-400"},y=xe(),ve=[y.accessor("id",{header:"Reference",cell:r=>{const s=r.row.original;return e.jsx("div",{children:e.jsx("span",{className:"cursor-pointer",children:s.id})})}}),y.accessor("item",{header:"Product"}),y.accessor("status",{header:"Status",cell:r=>{const s=r.row.original;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:ke[s.status]}),e.jsx("span",{className:"ml-2 rtl:mr-2 capitalize",children:s.status})]})}}),y.accessor("date",{header:"Date",cell:r=>{const s=r.row.original;return e.jsx("div",{className:"flex items-center",children:$.unix(s.date).format("MM/DD/YYYY")})}}),y.accessor("amount",{header:"Amount",cell:r=>{const s=r.row.original;return e.jsx("div",{className:"flex items-center",children:e.jsx(fe,{displayType:"text",value:(Math.round(s.amount*100)/100).toFixed(2),prefix:"$",thousandSeparator:!0})})}})],we=({data:r=[],...s})=>{const h=he({data:r,columns:ve,getCoreRowModel:ge()});return e.jsx("div",{...s,children:e.jsxs(P,{children:[e.jsx(Ee,{className:"!bg-transparent",children:h.getHeaderGroups().map(u=>e.jsx(q,{children:u.headers.map(l=>e.jsx(Te,{colSpan:l.colSpan,children:S(l.column.columnDef.header,l.getContext())},l.id))},u.id))}),e.jsx(Fe,{children:h.getRowModel().rows.map(u=>e.jsx(q,{children:u.getVisibleCells().map(l=>e.jsx(Ie,{children:S(l.column.columnDef.cell,l.getContext())},l.id))},u.id))})]})})},He=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],br=()=>{const[r,s]=M.useState({paymentMethods:[],otherMethod:[],billingHistory:[]}),[h,u]=M.useState({}),[l,p]=M.useState(""),d=async()=>{const t=await je();s(t.data)},m=(t,o)=>{J.push(e.jsx(L,{title:"Billing information updated",type:"success"}),{placement:"top-center"}),o(!1)},a=()=>{p(""),u({})},x=(t,o)=>{p(o),u(t)},I=(t,o,N)=>{let c=o.values[N.name];t.primary&&c.forEach(n=>{n.primary=!1}),c.some(n=>n.cardId===t.cardId)||c.push(t),c=c.map(n=>(n.cardId===t.cardId&&(n={...n,...t}),n));let C={};c=c.filter(n=>(n.primary&&(C=n),!n.primary)),c=[C,...c],o.setFieldValue(N.name,c),a()},E=t=>{const o=window.open(t,"_blank");o==null||o.focus()};return M.useEffect(()=>{d()},[]),e.jsx(A,{enableReinitialize:!0,initialValues:r,onSubmit:(t,{setSubmitting:o})=>{o(!0),setTimeout(()=>{m(t,o)},1e3)},children:({values:t,touched:o,errors:N,isSubmitting:c,resetForm:C})=>{var F,k;const n={touched:o,errors:N};return e.jsx(B,{children:e.jsxs(U,{children:[e.jsx(w,{title:"Payment Method",desc:"You can update your cards information here"}),e.jsxs(H,{name:"paymentMethods",alignCenter:!1,label:"Credit Cards",...n,children:[e.jsx("div",{className:"rounded-lg border border-gray-200 dark:border-gray-600",children:(F=t==null?void 0:t.paymentMethods)==null?void 0:F.map((i,b)=>e.jsxs("div",{className:v("flex items-center justify-between p-4",!V(t.paymentMethods,b)&&"border-b border-gray-200 dark:border-gray-600"),children:[e.jsxs("div",{className:"flex items-center",children:[i.cardType==="VISA"&&e.jsx("img",{src:"/img/others/img-8.png",alt:"visa"}),i.cardType==="MASTER"&&e.jsx("img",{src:"/img/others/img-9.png",alt:"master"}),e.jsxs("div",{className:"ml-3 rtl:mr-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"text-gray-900 dark:text-gray-100 font-semibold",children:[i.cardHolderName," ","••••"," ",i.last4Number]}),i.primary&&e.jsx(z,{className:"bg-sky-100 text-sky-600 dark:bg-sky-500/20 dark:text-sky-100 rounded-md border-0 mx-2",children:e.jsxs("span",{className:"capitalize",children:[" ","Primary"," "]})})]}),e.jsxs("span",{children:["Expired"," ",He[parseInt(i.expMonth)-1]," ","20",i.expYear]})]})]}),e.jsx("div",{className:"flex",children:e.jsx(f,{size:"sm",type:"button",onClick:()=>x(i,"EDIT"),children:"Edit"})})]},i.cardId))}),e.jsx("div",{className:"mt-2",children:e.jsx(f,{type:"button",variant:"plain",size:"sm",icon:e.jsx(de,{className:"text-lg"}),onClick:()=>x({},"NEW"),children:e.jsx("span",{className:"font-semibold",children:"Add new card"})})})]}),e.jsx(H,{border:!1,name:"otherMethod",alignCenter:!1,label:"Other payment methods",...n,children:e.jsx("div",{className:"rounded-lg border border-gray-200 dark:border-gray-600",children:(k=t==null?void 0:t.otherMethod)==null?void 0:k.map((i,b)=>e.jsxs("div",{className:v("flex items-center justify-between p-4",!V(t.otherMethod,b)&&"border-b border-gray-200 dark:border-gray-600"),children:[e.jsxs("div",{className:"flex items-center",children:[i.type==="PAYPAL"&&e.jsx("img",{src:"/img/others/img-10.png",alt:"visa"}),e.jsx("div",{className:"ml-3 rtl:mr-3 font-semibold",children:i.identifier})]}),e.jsx("div",{className:"flex",children:e.jsx(f,{size:"sm",type:"button",onClick:()=>E(i.redirect),children:"Edit"})})]},i.id))})}),e.jsxs(_,{isOpen:l==="NEW"||l==="EDIT",onClose:a,onRequestClose:a,children:[e.jsx("h5",{className:"mb-4",children:"Edit Credit Card"}),e.jsx(j,{name:"paymentMethods",children:({field:i,form:b})=>e.jsx(Me,{type:l,card:h,onUpdate:Y=>I(Y,b,i)})})]}),e.jsxs("div",{className:"mt-4 ltr:text-right",children:[e.jsx(f,{className:"ltr:mr-2 rtl:ml-2",type:"button",onClick:()=>C(),children:"Reset"}),e.jsx(f,{variant:"solid",loading:c,type:"submit",children:c?"Updating":"Update"})]}),e.jsx(w,{className:"mt-6",title:"Billing History",desc:"View your previos billing"}),e.jsx(we,{className:"mt-4 rounded-lg border border-gray-200 dark:border-gray-600",data:r.billingHistory})]})})}})};export{br as default};
