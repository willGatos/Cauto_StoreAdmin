import{r as i,j as e,ax as x,aw as P}from"./index-e9055987.js";import{C as O}from"./circle-plus-d9b5bf80.js";import{C as T,a as F}from"./chevron-right-32c326f0.js";import{P as R}from"./pencil-7983d55c.js";import{T as q}from"./trash-2-8957055b.js";import"./createLucideIcon-35c01f3b.js";const b={getCategories:async()=>{const{data:o,error:a}=await x.from("categories").select("*").order("id");if(a)throw a;const c=o.map(n=>({...n,subcategories:o.filter(l=>l.parent_id===n.id)}));return console.log(c),c||[]},createCategory:async(o,a,c)=>{const{data:n,error:l}=await x.from("categories").upsert({name:o,description:a,parent_id:c}).select("*").single();if(l)throw l;return n},updateCategory:async(o,a,c)=>{const{data:n,error:l}=await x.from("categories").update({name:a,description:c}).select("*").eq("id",o).single();if(l)throw l;return n},deleteCategory:async o=>{const{error:a}=await x.from("categories").delete().eq("id",o);if(a)throw a}};function _(){const[o,a]=i.useState([]),[c,n]=i.useState(!1),[l,p]=i.useState(!1),[y,v]=i.useState(null),[d,u]=i.useState(""),[m,g]=i.useState(""),[h,C]=i.useState(null),[f,k]=i.useState({});i.useEffect(()=>{S()},[]);const S=async()=>{const r=await b.getCategories();a(r)},D=async()=>{if(d.trim()){const r=await b.createCategory(d,m,h);console.log(r),r.subcategories=[],h?a(o.map(t=>t.id===h?{...t,subcategories:[...t.subcategories||[],r]}:t)):(r.subcategories=[],console.log(r),a([...o,r])),u(""),g(""),C(null),n(!1)}},E=async()=>{if(y&&d.trim()){const r=await b.updateCategory(y.id,d,m);a(N(o,r)),u(""),g(""),p(!1)}},I=async r=>{await b.deleteCategory(r),a(w(o,r))},N=(r,t)=>r.map(s=>s.id===t.id?{...s,name:t.name,description:t.description}:s.subcategories?{...s,subcategories:N(s.subcategories,t)}:s),w=(r,t)=>r.filter(s=>s.id!==t).map(s=>s.subcategories?{...s,subcategories:w(s.subcategories,t)}:s),M=r=>{k(t=>({...t,[r]:!t[r]}))},j=(r,t=0)=>r.map(s=>e.jsxs(P.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-gray-50 ${t>0?"bg-gray-100":""}`,children:[e.jsx("td",{className:"py-2 px-4 border-b",style:{paddingLeft:`${1+t*2}rem`},children:s.subcategories&&s.subcategories.length>0&&e.jsx("button",{onClick:()=>M(s.id),className:"focus:outline-none","aria-label":f[s.id]?"Contraer categoría":"Expandir categoría",children:f[s.id]?e.jsx(T,{className:"h-5 w-5 text-gray-500"}):e.jsx(F,{className:"h-5 w-5 text-gray-500"})})}),e.jsx("td",{className:"py-2 px-4 border-b",children:s.id}),e.jsx("td",{className:"py-2 px-4 border-b",children:s.name}),e.jsx("td",{className:"py-2 px-4 border-b",children:s.description}),e.jsxs("td",{className:"py-2 px-4 border-b",children:[e.jsx("button",{onClick:()=>{v(s),u(s.name),g(s.description),p(!0)},className:"text-blue-500 hover:text-blue-700 mr-2",children:e.jsx(R,{className:"inline-block"})}),e.jsx("button",{onClick:()=>I(s.id),className:"text-red-500 hover:text-red-700",children:e.jsx(q,{className:"inline-block"})})]})]}),f[s.id]&&s.subcategories&&s.subcategories.length>0&&j(s.subcategories,t+1)]},s.id));return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Gestor de Categorías"}),e.jsxs("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-4",onClick:()=>{C(null),n(!0)},children:[e.jsx(O,{className:"inline-block mr-2"}),"Crear Categoría"]}),e.jsxs("table",{className:"min-w-full bg-white border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"py-2 px-4 border-b text-left"}),e.jsx("th",{className:"py-2 px-4 border-b text-left",children:"ID"}),e.jsx("th",{className:"py-2 px-4 border-b text-left",children:"Nombre"}),e.jsx("th",{className:"py-2 px-4 border-b text-left",children:"Descripción"}),e.jsx("th",{className:"py-2 px-4 border-b text-left",children:"Acciones"})]})}),e.jsx("tbody",{children:j(o)})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Crear Nueva Categoría"}),e.jsxs("div",{className:"mt-2 px-7 py-3",children:[e.jsx("input",{type:"text",value:d,onChange:r=>u(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-300 mb-3",placeholder:"Nombre de la categoría"}),e.jsx("textarea",{value:m,onChange:r=>g(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-300 mb-3",placeholder:"Descripción de la categoría",rows:3})]}),e.jsxs("div",{className:"items-center px-4 py-3",children:[e.jsx("button",{onClick:D,className:"px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Crear"}),e.jsx("button",{onClick:()=>n(!1),className:"mt-3 px-4 py-2 bg-gray-300 text-gray-800 text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Cancelar"})]})]})})}),l&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Editar Categoría"}),e.jsxs("div",{className:"mt-2 px-7 py-3",children:[e.jsx("input",{type:"text",value:d,onChange:r=>u(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-300 mb-3",placeholder:"Nombre de la categoría"}),e.jsx("textarea",{value:m,onChange:r=>g(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-300 mb-3",placeholder:"Descripción de la categoría",rows:3})]}),e.jsxs("div",{className:"items-center px-4 py-3",children:[e.jsx("button",{onClick:E,className:"px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Actualizar"}),e.jsx("button",{onClick:()=>p(!1),className:"mt-3 px-4 py-2 bg-gray-300 text-gray-800 text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Cancelar"})]})]})})})]})}export{_ as default};
