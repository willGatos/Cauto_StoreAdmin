import{j as e,r as p,ah as U,c as le,ap as $,aq as ce,ar as ie,as as me,a as b,w as V,g as de,at as ue}from"./index-e9055987.js";import{A as pe}from"./AdaptableCard-459786db.js";import{A as W}from"./index-48bcc748.js";import{B as H}from"./Badge-9568a8b0.js";import{T as B}from"./index-95867d9f.js";import{S as k,P as ge}from"./Skeleton-ede84c2e.js";import{S as J,c as xe}from"./Select-3959542b.js";import{C as he}from"./index-0b16cfb5.js";import{u as Ce,g as fe,a as je,b as be,d as we,f as q}from"./index-f0b8471c.js";import{b as Se,c as ve,d as ye}from"./CrmService-f5d63b63.js";import{u as Q}from"./useThemeClass-84f44b3e.js";import{B as F}from"./Button-ba65fcd6.js";import{D as Ne}from"./Drawer-1d10f851.js";import{c as y}from"./cloneDeep-860e24f8.js";import{i as Te}from"./Views-51136580.js";import{C as De}from"./CustomerForm-f35965f2.js";import{I as ke}from"./Input-cff490ba.js";import{C as Re,E as Ae,f as Ie,T as ze,u as Me}from"./index.esm-1ac4f407.js";import{d as Pe}from"./debounce-85f84bbc.js";import{C as Oe}from"./Card-433b6df5.js";import{G as Ee}from"./GrowShrinkTag-df3aa6a2.js";import{N as Fe}from"./react-number-format.es-1ce1616c.js";import"./Tooltip-c9ef7fc2.js";import"./warning-6ee4a779.js";import"./index-8f83c5d8.js";import"./motion-4061acbd.js";import"./get-c3140d19.js";import"./_MapCache-0feb66c1.js";import"./_Uint8Array-1ce16692.js";import"./_baseIsEqual-7de73e16.js";import"./index-1248b5e2.js";import"./CloseButton-3f8e850c.js";import"./_getPrototype-241bf201.js";import"./index-470afdad.js";import"./useControllableState-461bebfa.js";import"./FormItem-ea0b05bc.js";import"./formik.esm-026afa26.js";import"./index.esm-6e43d029.js";import"./index-6ec4b8b8.js";import"./useRootClose-9a8a5c26.js";import"./useDidUpdate-5adca6d0.js";import"./Upload-73c59612.js";import"./toast-38b8809c.js";import"./StatusIcon-879e2680.js";import"./isNil-1a93575e.js";import"./Tag-0c9ab60f.js";const{Tr:Le,Td:$e,TBody:He}=B,Be=s=>{const{columns:t=1,rows:a=10,avatarInColumns:o=[],avatarProps:l}=s;return e.jsx(He,{children:Array.from(new Array(a),(n,r)=>r+0).map(n=>e.jsx(Le,{children:Array.from(new Array(t),(r,c)=>c+0).map(r=>e.jsx($e,{children:e.jsxs("div",{className:"flex flex-auto items-center gap-2",children:[o.includes(r)&&e.jsx("div",{children:e.jsx(k,{variant:"circle",...l})}),e.jsx(k,{})]})},`col-${r}`))},`row-${n}`))})},{Tr:_,Th:Ye,Td:qe,THead:_e,TBody:Ge,Sorter:Ke}=B,G=s=>{const{indeterminate:t,onChange:a,onCheckBoxChange:o,onIndeterminateCheckBoxChange:l,...n}=s,r=p.useRef(null);p.useEffect(()=>{typeof t=="boolean"&&r.current&&(r.current.indeterminate=!n.checked&&t)},[r,t]);const c=g=>{a(g),o==null||o(g),l==null||l(g)};return e.jsx(he,{ref:r,className:"mb-0",onChange:(g,x)=>c(x),...n})};function Ue(s,t){const{skeletonAvatarColumns:a,columns:o=[],data:l=[],loading:n=!1,onCheckBoxChange:r,onIndeterminateCheckBoxChange:c,onPaginationChange:g,onSelectChange:x,onSort:h,pageSizes:w=[10,25,50,100],selectable:S=!1,skeletonAvatarProps:N,pagingData:v={total:0,pageIndex:1,pageSize:10}}=s,{pageSize:d,pageIndex:u,total:M}=v,[f,P]=p.useState(null),R=p.useMemo(()=>w.map(m=>({value:m,label:`${m} / page`})),[w]),T=(m,i)=>{n||r==null||r(m,i)},D=(m,i)=>{n||c==null||c(m,i)},j=m=>{n||g==null||g(m)},re=m=>{n||x==null||x(Number(m))};p.useEffect(()=>{if(Array.isArray(f)){const m=f.length>0?f[0].desc?"desc":"asc":"",i=f.length>0?f[0].id:"";h==null||h({order:m,key:i})}},[f]);const Y=p.useMemo(()=>{const m=o;return S?[{id:"select",header:({table:i})=>e.jsx(G,{checked:i.getIsAllRowsSelected(),indeterminate:i.getIsSomeRowsSelected(),onChange:i.getToggleAllRowsSelectedHandler(),onIndeterminateCheckBoxChange:O=>{D(O.target.checked,i.getRowModel().rows)}}),cell:({row:i})=>e.jsx(G,{checked:i.getIsSelected(),disabled:!i.getCanSelect(),indeterminate:i.getIsSomeSelected(),onChange:i.getToggleSelectedHandler(),onCheckBoxChange:O=>T(O.target.checked,i.original)})},...m]:m},[o,S]),A=Ce({data:l,columns:Y,getCoreRowModel:fe(),getFilteredRowModel:je(),getPaginationRowModel:be(),getSortedRowModel:we(),manualPagination:!0,manualSorting:!0,onSortingChange:m=>{P(m)},state:{sorting:f}}),oe=()=>{A.resetSorting()},ne=()=>{A.toggleAllRowsSelected(!1)};return p.useImperativeHandle(t,()=>({resetSorting:oe,resetSelected:ne})),e.jsxs(U,{loading:n&&l.length!==0,type:"cover",children:[e.jsxs(B,{children:[e.jsx(_e,{children:A.getHeaderGroups().map(m=>e.jsx(_,{children:m.headers.map(i=>e.jsx(Ye,{colSpan:i.colSpan,children:i.isPlaceholder?null:e.jsxs("div",{className:le(i.column.getCanSort()&&"cursor-pointer select-none point",n&&"pointer-events-none"),onClick:i.column.getToggleSortingHandler(),children:[q(i.column.columnDef.header,i.getContext()),i.column.getCanSort()&&e.jsx(Ke,{sort:i.column.getIsSorted()})]})},i.id))},m.id))}),n&&l.length===0?e.jsx(Be,{columns:Y.length,rows:v.pageSize,avatarInColumns:a,avatarProps:N}):e.jsx(Ge,{children:A.getRowModel().rows.slice(0,d).map(m=>e.jsx(_,{children:m.getVisibleCells().map(i=>e.jsx(qe,{children:q(i.column.columnDef.cell,i.getContext())},i.id))},m.id))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(ge,{pageSize:d,currentPage:u,total:M,onChange:j}),e.jsx("div",{style:{minWidth:130},children:e.jsx(J,{size:"sm",menuPlacement:"top",isSearchable:!1,value:R.filter(m=>m.value===d),options:R,onChange:m=>re(m==null?void 0:m.value)})})]})]})}const Ve=p.forwardRef(Ue),We="crmCustomers",L=$("crmCustomers/data/getCustomerStatistic",async()=>(await Se()).data),z=$("crmCustomers/data/getCustomers",async s=>(await ve(s)).data),Je=$("crmCustomers/data/putCustomer",async s=>(await ye(s)).data),Qe={total:0,pageIndex:1,pageSize:10,query:"",sort:{order:"",key:""}},Xe={status:""},Ze={loading:!1,statisticLoading:!1,customerList:[],statisticData:{},tableData:Qe,filterData:Xe,drawerOpen:!1,selectedCustomer:{}},X=ce({name:`${We}/state`,initialState:Ze,reducers:{setTableData:(s,t)=>{s.tableData=t.payload},setCustomerList:(s,t)=>{s.customerList=t.payload},setFilterData:(s,t)=>{s.filterData=t.payload},setSelectedCustomer:(s,t)=>{s.selectedCustomer=t.payload},setDrawerOpen:s=>{s.drawerOpen=!0},setDrawerClose:s=>{s.drawerOpen=!1}},extraReducers:s=>{s.addCase(z.fulfilled,(t,a)=>{t.customerList=a.payload.data,t.tableData.total=a.payload.total,t.loading=!1}).addCase(z.pending,t=>{t.loading=!0}).addCase(L.fulfilled,(t,a)=>{t.statisticData=a.payload,t.statisticLoading=!1}).addCase(L.pending,t=>{t.statisticLoading=!0})}}),{setTableData:I,setCustomerList:et,setFilterData:Z,setSelectedCustomer:ee,setDrawerOpen:tt,setDrawerClose:te}=X.actions,st=X.reducer,at=ie({data:st}),C=me,se=p.forwardRef((s,t)=>{const a=b(),o=C(c=>c.crmCustomers.data.selectedCustomer),l=C(c=>c.crmCustomers.data.customerList),{id:n}=o,r=c=>{const{name:g,birthday:x,email:h,img:w,location:S,title:N,phoneNumber:v,facebook:d,twitter:u,pinterest:M,linkedIn:f}=c,P={name:g,email:h,img:w},R={location:S,title:N,birthday:V(x).format("DD/MM/YYYY"),phoneNumber:v,facebook:d,twitter:u,pinterest:M,linkedIn:f};let T=y(l),D={};T=T.map(j=>(j.id===n&&(j={...j,...P},j.personalInfo={...j.personalInfo,...R},D=j),j)),Te(D)||a(Je(D)),a(te()),a(et(T))};return e.jsx(De,{ref:t,customer:o,onFormSubmit:r})});se.displayName="CustomerEditContent";const rt=({onSaveClick:s,onCancel:t})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(F,{size:"sm",className:"mr-2",onClick:t,children:"Cancel"}),e.jsx(F,{size:"sm",variant:"solid",onClick:s,children:"Save"})]}),ot=()=>{const s=b(),t=C(n=>n.crmCustomers.data.drawerOpen),a=()=>{s(te()),s(ee({}))},o=p.useRef(null),l=()=>{var n;(n=o.current)==null||n.submitForm()};return e.jsx(Ne,{isOpen:t,closable:!1,bodyClass:"p-0",footer:e.jsx(rt,{onCancel:a,onSaveClick:l}),onClose:a,onRequestClose:a,children:e.jsx(se,{ref:o})})},nt={active:"bg-emerald-500",blocked:"bg-red-500"},lt=({row:s})=>{const{textTheme:t}=Q(),a=b(),o=()=>{a(tt()),a(ee(s))};return e.jsx("div",{className:`${t} cursor-pointer select-none font-semibold`,onClick:o,children:"Edit"})},ct=({row:s})=>{const{textTheme:t}=Q();return e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{size:28,shape:"circle",src:s.img}),e.jsx(de,{className:`hover:${t} ml-2 rtl:mr-2 font-semibold`,to:`/app/crm/customer-details?id=${s.id}`,children:s.name})]})},it=()=>{const s=b(),t=C(d=>d.crmCustomers.data.customerList),a=C(d=>d.crmCustomers.data.loading),o=C(d=>d.crmCustomers.data.filterData),{pageIndex:l,pageSize:n,sort:r,query:c,total:g}=C(d=>d.crmCustomers.data.tableData),x=p.useCallback(()=>{s(z({pageIndex:l,pageSize:n,sort:r,query:c,filterData:o}))},[l,n,r,c,o,s]);p.useEffect(()=>{x()},[x,l,n,r,o]);const h=p.useMemo(()=>({pageIndex:l,pageSize:n,sort:r,query:c,total:g}),[l,n,r,c,g]),w=p.useMemo(()=>[{header:"Name",accessorKey:"name",cell:d=>{const u=d.row.original;return e.jsx(ct,{row:u})}},{header:"Email",accessorKey:"email"},{header:"Status",accessorKey:"status",cell:d=>{const u=d.row.original;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:nt[u.status]}),e.jsx("span",{className:"ml-2 rtl:mr-2 capitalize",children:u.status})]})}},{header:"Last online",accessorKey:"lastOnline",cell:d=>{const u=d.row.original;return e.jsx("div",{className:"flex items-center",children:V.unix(u.lastOnline).format("MM/DD/YYYY")})}},{header:"",id:"action",cell:d=>e.jsx(lt,{row:d.row.original})}],[]),S=d=>{const u=y(h);u.pageIndex=d,s(I(u))},N=d=>{const u=y(h);u.pageSize=Number(d),u.pageIndex=1,s(I(u))},v=d=>{const u=y(h);u.sort=d,s(I(u))};return e.jsxs(e.Fragment,{children:[e.jsx(Ve,{columns:w,data:t,skeletonAvatarColumns:[0],skeletonAvatarProps:{width:28,height:28},loading:a,pagingData:{total:h.total,pageIndex:h.pageIndex,pageSize:h.pageSize},onPaginationChange:S,onSelectChange:N,onSort:v}),e.jsx(ot,{})]})},ae=p.forwardRef((s,t)=>{const{onInputChange:a}=s,o=Pe(l,500);function l(r){a==null||a(r)}const n=r=>{o(r.target.value)};return e.jsx(ke,{ref:t,className:"max-w-md md:w-52 mb-4",size:"sm",placeholder:"Search",prefix:e.jsx(Re,{className:"text-lg"}),onChange:n})});ae.displayName="CustomerTableSearch";const{Control:mt}=xe,K=[{value:"",label:"All",color:"bg-gray-500"},{value:"active",label:"Active",color:"bg-emerald-500"},{value:"blocked",label:"Blocked",color:"bg-red-500"}],dt=({innerProps:s,label:t,data:a,isSelected:o})=>e.jsxs("div",{className:`flex items-center justify-between p-2 cursor-pointer ${o?"bg-gray-100 dark:bg-gray-500":"hover:bg-gray-50 dark:hover:bg-gray-600"}`,...s,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{innerClass:a.color}),e.jsx("span",{children:t})]}),o&&e.jsx(Ae,{className:"text-emerald-500 text-xl"})]}),ut=({children:s,...t})=>{const a=t.getValue()[0];return e.jsxs(mt,{...t,children:[a&&e.jsx(H,{className:"ltr:ml-4 rtl:mr-4",innerClass:a.color}),s]})},pt=()=>{const s=b(),{status:t}=C(o=>o.crmCustomers.data.filterData),a=o=>{s(Z({status:o==null?void 0:o.value}))};return e.jsx(J,{options:K,size:"sm",className:"mb-4 min-w-[130px]",components:{Option:dt,Control:ut},value:K.filter(o=>o.value===t),onChange:a})},gt=()=>{const s=b(),t=p.useRef(null),a=C(r=>r.crmCustomers.data.tableData),o=r=>{const c=y(a);c.query=r,c.pageIndex=1,typeof r=="string"&&r.length>1&&l(c),typeof r=="string"&&r.length===0&&l(c)},l=r=>{s(I(r)),s(z(r))},n=()=>{const r=y(a);r.query="",t.current&&(t.current.value=""),s(Z({status:""})),l(r)};return e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsxs("div",{className:"md:flex items-center gap-4",children:[e.jsx(ae,{ref:t,onInputChange:o}),e.jsx(pt,{})]}),e.jsx("div",{className:"mb-4",children:e.jsx(F,{size:"sm",onClick:n,children:"Clear All"})})]})},xt=s=>{const{showAvatar:t=!0,avatarProps:a,titleProps:o,textProps:l}=s;return e.jsxs("div",{className:"flex flex-auto items-center gap-2",children:[t&&e.jsx("div",{children:e.jsx(k,{variant:"circle",...a})}),e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[e.jsx(k,{width:"40%",...o}),e.jsx(k,{width:"20%",...l})]})]})},E=s=>{const{icon:t,avatarClass:a,label:o,value:l,growthRate:n,loading:r}=s,c=55;return e.jsx(Oe,{bordered:!0,children:e.jsx(U,{loading:r,customLoader:e.jsx(xt,{avatarProps:{className:"rounded",width:c,height:c}}),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(W,{className:a,size:c,icon:t}),e.jsxs("div",{children:[e.jsx("span",{children:o}),e.jsx("h3",{children:e.jsx(Fe,{thousandSeparator:!0,displayType:"text",value:l})})]})]}),e.jsx(Ee,{value:n,suffix:"%"})]})})})},ht=()=>{var o,l,n,r,c,g;const s=b(),t=C(x=>x.crmCustomers.data.statisticData),a=C(x=>x.crmCustomers.data.statisticLoading);return p.useEffect(()=>{s(L())},[]),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 mb-6",children:[e.jsx(E,{icon:e.jsx(Ie,{}),avatarClass:"!bg-indigo-600",label:"Total Customers",value:(o=t==null?void 0:t.totalCustomers)==null?void 0:o.value,growthRate:(l=t==null?void 0:t.totalCustomers)==null?void 0:l.growShrink,loading:a}),e.jsx(E,{icon:e.jsx(ze,{}),avatarClass:"!bg-blue-500",label:"Active Customers",value:(n=t==null?void 0:t.activeCustomers)==null?void 0:n.value,growthRate:(r=t==null?void 0:t.activeCustomers)==null?void 0:r.growShrink,loading:a}),e.jsx(E,{icon:e.jsx(Me,{}),avatarClass:"!bg-emerald-500",label:"New Customers",value:(c=t==null?void 0:t.newCustomers)==null?void 0:c.value,growthRate:(g=t==null?void 0:t.newCustomers)==null?void 0:g.growShrink,loading:a})]})};ue("crmCustomers",at);const Ct=()=>e.jsxs(e.Fragment,{children:[e.jsx(ht,{}),e.jsxs(pe,{className:"h-full",bodyClass:"h-full",children:[e.jsx(gt,{}),e.jsx(it,{})]})]}),ms=Ct;export{ms as default};
