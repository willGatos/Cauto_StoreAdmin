import{r as l,u as z,j as e,ax as p}from"./index-e9055987.js";import{B as j}from"./Button-ba65fcd6.js";import{I}from"./Input-cff490ba.js";import{S as V}from"./Select-3959542b.js";import"./Alert-102e0217.js";import"./index-48bcc748.js";import"./Badge-9568a8b0.js";import"./Card-433b6df5.js";import"./index-0b16cfb5.js";import"./index-6ec4b8b8.js";import"./Dialog-0f29b530.js";import"./Drawer-1d10f851.js";import"./ScrollBar-7cb0876a.js";import"./FormItem-ea0b05bc.js";import"./index-cba86877.js";import"./index-fd641029.js";import"./toast-38b8809c.js";import"./Skeleton-ede84c2e.js";import"./index-6bfd69bd.js";import"./index-ca92c429.js";import"./Switcher-fc6ab2a0.js";import{T as v}from"./index-95867d9f.js";import"./index-470afdad.js";import"./Tag-0c9ab60f.js";import"./index-b1813226.js";import"./Tooltip-c9ef7fc2.js";import"./Upload-73c59612.js";import{N as F}from"./NotificationMessage-318362a9.js";import"./Views-51136580.js";import"./isNil-1a93575e.js";import"./get-c3140d19.js";import"./_MapCache-0feb66c1.js";import"./index.esm-1ac4f407.js";import"./StatusIcon-879e2680.js";import"./CloseButton-3f8e850c.js";import"./motion-4061acbd.js";import"./cloneDeep-860e24f8.js";import"./_Uint8Array-1ce16692.js";import"./_getPrototype-241bf201.js";import"./_baseIsEqual-7de73e16.js";import"./useControllableState-461bebfa.js";import"./useRootClose-9a8a5c26.js";import"./useDidUpdate-5adca6d0.js";import"./index-1248b5e2.js";import"./warning-6ee4a779.js";import"./useUncertainRef-63de6025.js";import"./index-8f83c5d8.js";const H=async s=>{const{data:t,error:o}=await p.from("products").select("*").eq("shop_id",s).order("standard_price");return o?console.error("Error al obtener productos:",o):console.log("Productos obtenidos:",t),t},b=[{label:"Grilla",value:"Grid"},{label:"Flex",value:"Flex"}],O=async s=>{const{data:t,error:o}=await p.from("catalog_sections").insert({shop_id:s.shopId,name:s.name,type_of_view:s.type_of_view}).select();return o?console.error("Error al guardar sección:",o):console.log("Sección guardada:",t[0]),t[0]},R=async(s,t)=>{try{const{data:o}=await p.from("catalog_sections").update({name:t.name,type_of_view:t.type_of_view}).eq("id",s).select();if(!o||!o.length)throw new Error("Sección no encontrada");return t.products&&await T(s,t.products.map(i=>i.id)),o[0]}catch(o){throw console.error("Error al actualizar la sección:",o),o}},T=async(s,t)=>{try{console.log("HOLA",s),await p.from("catalog_section_products").delete().eq("catalog_section_id",s);const{data:o,error:i}=await p.from("catalog_section_products").insert(t.map(n=>({catalog_section_id:s,product_id:n})));if(i)throw i;return console.log("Productos agregados a la sección:",o),o}catch(o){throw console.error("Error al agregar productos a la sección:",o),o}},L=async s=>{try{const{data:t,error:o}=await p.from("catalog_sections").select(`
        *,
        products: catalog_section_products (
          product_id (
            *
          )
        )
      `);if(o)throw o;return console.log(t),t.map(i=>({...i,products:i.products.map(n=>n.product_id)}))}catch(t){throw console.error("Error al obtener secciones y productos:",t),t}},{Tr:g,Th:d,Td:m,THead:E,TBody:P}=v;function Ve(){const[s,t]=l.useState([]),[o,i]=l.useState(null),[n,x]=l.useState(""),[f,w]=l.useState(),[c,u]=l.useState([]),[C,A]=l.useState([]),[_,y]=l.useState(!1),G=r=>{i(r),x(r.name),w(b.find(({value:a})=>a==r.type_of_view)),u(r.products.map(a=>a.id)),y(!0)},k=()=>{i(null),x(""),u([]),y(!1)},{shopId:S}=z(r=>r.auth.user);l.useEffect(()=>{L().then(t),H(S).then(A)},[]);const B=r=>{c.includes(r)||u([...c,r])},$=r=>{u(c.filter(a=>a!==r))},q=async()=>{if(!n.trim()){alert("Por favor, ingresa un nombre para la sección.");return}if(c.length===0){alert("Por favor, selecciona al menos un producto.");return}const r={id:null,name:n.trim(),type_of_view:f.value,products:c.map(a=>({id:a}))};try{const a=_?await R(o.id,{name:n,type_of_view:f.value,products:c.map(h=>({id:h}))}):await O({shopId:S,name:n.trim(),type_of_view:f.value,products:c.map(h=>({id:h}))});x(""),u([]),r.id=a.id;const M=await T(a.id,c);t(h=>h.map(N=>N.id===a.id?{...a,products:c}:N))}catch(a){console.error("No se pudo guardar la sección:",a),alert("Error al guardar la sección.")}};return e.jsxs("div",{className:"space-y-8 p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gestionar Secciones del Catálogo"}),e.jsxs("div",{className:"flex flex-wrap gap-5",children:[e.jsx(I,{placeholder:"Nombre de la sección",value:n,onChange:r=>x(r.target.value),className:"max-w-md"}),e.jsx(V,{placeholder:"Tipo de vista",value:f,onChange:r=>{w(r)},options:b})]}),e.jsx(F,{buttonText:_?"Actualizar Sección":"Guardar Sección",notifcationText:"Exito en la Creacion de la Seccion",action:()=>{q()}}),_&&e.jsx(j,{variant:"secondary",onClick:k,children:"Cancelar Edición"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Seleccionar Productos"}),e.jsxs(v,{children:[e.jsx(E,{children:e.jsxs(g,{children:[e.jsx(d,{children:"Nombre"}),e.jsx(d,{children:"Precio"}),e.jsx(d,{children:"Acción"})]})}),e.jsx(P,{children:C.map(r=>e.jsxs(g,{children:[e.jsx(m,{children:r.name}),e.jsxs(m,{children:["$",r.standard_price]}),e.jsx(m,{children:c.includes(r.id)?e.jsx(j,{variant:"default",onClick:()=>$(r.id),children:"Quitar"}):e.jsx(j,{variant:"default",onClick:()=>B(r.id),children:"Añadir"})})]},r.id))})]})]}),o&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h5",{className:" font-semibold",children:"Previsualización:"}),e.jsx("h3",{children:o.name}),e.jsx("div",{className:`
            ${o.type_of_view==="Grid"?"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8 justify-items-center":"flex overflow-x-auto pb-4 space-x-8"}
          `,children:o.products.map(r=>e.jsxs("div",{className:`
                border p-6 rounded-lg shadow-md
                ${o.type_of_view==="Grid"?"w-full":"w-64 flex-shrink-0"}
              `,children:[e.jsx("img",{src:r.images,alt:r.name,className:"w-full h-48 object-cover mb-4 rounded"}),e.jsx("h4",{className:"font-semibold text-lg mb-2",children:r.name}),e.jsxs("p",{className:"text-xl font-bold",children:["$",r.standard_price]})]},r.id))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Secciones Existentes"}),e.jsxs(v,{children:[e.jsx(E,{children:e.jsxs(g,{children:[e.jsx(d,{children:"Nombre"}),e.jsx(d,{children:"Tipo de Vista"}),e.jsx(d,{children:"Productos"}),e.jsx(d,{children:"Acción"})]})}),e.jsx(P,{children:s.map(r=>e.jsxs(g,{children:[e.jsx(m,{children:r.name}),e.jsx(m,{children:r.type_of_view}),e.jsx(m,{children:r.products.length}),e.jsx(m,{children:e.jsx(j,{onClick:()=>G(r),children:"Editar"})})]},r.id))})]})]})]})}export{T as addProductsToSection,Ve as default,H as getProductsByShopId,O as saveCatalogSectionToApi,R as updateCatalogSection};
