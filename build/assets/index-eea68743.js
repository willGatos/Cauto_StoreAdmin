import{ap as P,aq as ee,ar as se,as as te,a as j,r as h,j as e,w as S,ao as ae,c as re,at as oe,au as le,ah as ie}from"./index-e9055987.js";import{A as ne}from"./AdaptableCard-459786db.js";import{C as ce,i as E}from"./Views-51136580.js";import{D as de}from"./DoubleSidedImage-a17c8994.js";import{C as V}from"./Card-433b6df5.js";import{A as Y}from"./index-48bcc748.js";import{B as u}from"./Button-ba65fcd6.js";import{t as me,N as ue}from"./toast-38b8809c.js";import{C as z}from"./ConfirmDialog-d3517bf8.js";import{F as pe,a as xe,b as he,c as ge,T as O}from"./index-95867d9f.js";import{U as je,V as q,W as fe}from"./index.esm-1ac4f407.js";import{e as Ce,f as De,d as ye}from"./CrmService-f5d63b63.js";import{D as be}from"./Drawer-1d10f851.js";import{C as Ne}from"./CustomerForm-f35965f2.js";import{c as w}from"./cloneDeep-860e24f8.js";import{B as ve}from"./Badge-9568a8b0.js";import{c as Me,u as Pe,g as Se,d as we,f as F}from"./index-f0b8471c.js";import{N as $}from"./react-number-format.es-1ce1616c.js";import{T as B}from"./Tag-0c9ab60f.js";import{I as ke}from"./Input-cff490ba.js";import{D as Ee}from"./Dialog-0f29b530.js";import{F as Fe,a as f}from"./FormItem-ea0b05bc.js";import{F as Ie,a as He,b as y}from"./formik.esm-026afa26.js";import{F as I,a as Te}from"./FormPatternInput-8dff4752.js";import{c as Re,a as b}from"./index.esm-6e43d029.js";import{i as Ae}from"./isLastChild-83eb4c23.js";import"./Tooltip-c9ef7fc2.js";import"./warning-6ee4a779.js";import"./index-8f83c5d8.js";import"./motion-4061acbd.js";import"./StatusIcon-879e2680.js";import"./CloseButton-3f8e850c.js";import"./index-1248b5e2.js";import"./index-470afdad.js";import"./useControllableState-461bebfa.js";import"./index-6ec4b8b8.js";import"./useRootClose-9a8a5c26.js";import"./get-c3140d19.js";import"./_MapCache-0feb66c1.js";import"./useDidUpdate-5adca6d0.js";import"./Upload-73c59612.js";import"./_Uint8Array-1ce16692.js";import"./_getPrototype-241bf201.js";import"./isNil-1a93575e.js";const N="crmCustomerDetails",M=P(N+"/getCustomer",async s=>(await Ce(s)).data),Ve=P(N+"/deleteCustomer",async s=>(await De(s)).data),Ye=P(N+"/putCustomer",async s=>(await ye(s)).data),ze={loading:!0,profileData:{},subscriptionData:[],paymentHistoryData:[],paymentMethodData:[],deletePaymentMethodDialog:!1,editPaymentMethodDialog:!1,editCustomerDetailDialog:!1,selectedCard:{}},L=ee({name:`${N}/state`,initialState:ze,reducers:{updatePaymentMethodData:(s,t)=>{s.paymentMethodData=t.payload},updateProfileData:(s,t)=>{s.profileData=t.payload},openDeletePaymentMethodDialog:s=>{s.deletePaymentMethodDialog=!0},closeDeletePaymentMethodDialog:s=>{s.deletePaymentMethodDialog=!1},openEditPaymentMethodDialog:s=>{s.editPaymentMethodDialog=!0},closeEditPaymentMethodDialog:s=>{s.editPaymentMethodDialog=!1},openEditCustomerDetailDialog:s=>{s.editCustomerDetailDialog=!0},closeEditCustomerDetailDialog:s=>{s.editCustomerDetailDialog=!1},updateSelectedCard:(s,t)=>{s.selectedCard=t.payload}},extraReducers:s=>{s.addCase(M.fulfilled,(t,l)=>{var i,a,r;t.loading=!1,t.profileData=l.payload,t.subscriptionData=((i=l.payload)==null?void 0:i.subscription)||[],t.paymentHistoryData=((a=l.payload)==null?void 0:a.orderHistory)||[],t.paymentMethodData=((r=l.payload)==null?void 0:r.paymentMethod)||[]}).addCase(M.pending,t=>{t.loading=!0})}}),{updatePaymentMethodData:U,updateProfileData:Oe,openDeletePaymentMethodDialog:qe,closeDeletePaymentMethodDialog:H,openEditPaymentMethodDialog:$e,closeEditPaymentMethodDialog:Be,openEditCustomerDetailDialog:Le,closeEditCustomerDetailDialog:Ue,updateSelectedCard:T}=L.actions,Je=L.reducer,Ge=se({data:Je}),m=te,Qe=({onSaveClick:s,onCancel:t})=>e.jsxs("div",{className:"text-right w-full",children:[e.jsx(u,{size:"sm",className:"mr-2",onClick:t,children:"Cancel"}),e.jsx(u,{size:"sm",variant:"solid",onClick:s,children:"Save"})]}),We=()=>{const s=j(),t=h.useRef(null),l=m(o=>o.crmCustomerDetails.data.editCustomerDetailDialog),i=m(o=>o.crmCustomerDetails.data.profileData),a=()=>{s(Ue())},r=()=>{var o;(o=t.current)==null||o.submitForm()},c=o=>{const n=w(i),{name:p,birthday:d,email:x,img:v,location:g,title:J,phoneNumber:G,facebook:Q,twitter:W,pinterest:_,linkedIn:K}=o,X={name:p,email:x,img:v},Z={location:g,title:J,birthday:S(d).format("DD/MM/YYYY"),phoneNumber:G,facebook:Q,twitter:W,pinterest:_,linkedIn:K};n.personalInfo={...n.personalInfo,...Z};const k={...n,...X};s(Oe(k)),s(Ye(k)),a()};return e.jsx(be,{isOpen:l,closable:!1,bodyClass:"p-0",footer:e.jsx(Qe,{onCancel:a,onSaveClick:r}),onClose:a,onRequestClose:a,children:e.jsx(Ne,{ref:t,customer:i,onFormSubmit:c})})},C=({title:s,value:t})=>e.jsxs("div",{children:[e.jsx("span",{children:s}),e.jsx("p",{className:"text-gray-700 dark:text-gray-200 font-semibold",children:t})]}),_e=({id:s})=>{const t=j(),[l,i]=h.useState(!1),a=ae(),r=()=>{i(!1)},c=()=>{i(!0)},o=()=>{i(!1),s&&t(Ve({id:s})),a("/app/crm/customers"),me.push(e.jsx(ue,{title:"Successfuly Deleted",type:"success",children:"Customer successfuly deleted"}))},n=()=>{t(Le())};return e.jsxs(e.Fragment,{children:[e.jsx(u,{block:!0,icon:e.jsx(je,{}),onClick:c,children:"Delete"}),e.jsx(u,{block:!0,icon:e.jsx(q,{}),variant:"solid",onClick:n,children:"Edit"}),e.jsx(z,{isOpen:l,type:"danger",title:"Delete customer",confirmButtonColor:"red-600",onClose:r,onRequestClose:r,onCancel:r,onConfirm:o,children:e.jsx("p",{children:"Are you sure you want to delete this customer? All record related to this customer will be deleted as well. This action cannot be undone."})}),e.jsx(We,{})]})},Ke=({data:s={}})=>{var t,l,i,a;return e.jsx(V,{children:e.jsxs("div",{className:"flex flex-col xl:justify-between h-full 2xl:min-w-[360px] mx-auto",children:[e.jsxs("div",{className:"flex xl:flex-col items-center gap-4",children:[e.jsx(Y,{size:90,shape:"circle",src:s.img}),e.jsx("h4",{className:"font-bold",children:s.name})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-1 gap-y-7 gap-x-4 mt-8",children:[e.jsx(C,{title:"Email",value:s.email}),e.jsx(C,{title:"Phone",value:(t=s.personalInfo)==null?void 0:t.phoneNumber}),e.jsx(C,{title:"Location",value:(l=s.personalInfo)==null?void 0:l.location}),e.jsx(C,{title:"Date of birth",value:(i=s.personalInfo)==null?void 0:i.birthday}),e.jsx(C,{title:"Title",value:(a=s.personalInfo)==null?void 0:a.title}),e.jsxs("div",{className:"mb-7",children:[e.jsx("span",{children:"Social"}),e.jsxs("div",{className:"flex mt-4",children:[e.jsx(u,{className:"mr-2",shape:"circle",size:"sm",icon:e.jsx(pe,{className:"text-[#1773ea]"})}),e.jsx(u,{className:"mr-2",shape:"circle",size:"sm",icon:e.jsx(xe,{className:"text-[#1da1f3]"})}),e.jsx(u,{className:"mr-2",shape:"circle",size:"sm",icon:e.jsx(he,{className:"text-[#0077b5]"})}),e.jsx(u,{className:"mr-2",shape:"circle",size:"sm",icon:e.jsx(ge,{className:"text-[#df0018]"})})]})]})]}),e.jsx("div",{className:"mt-4 flex flex-col xl:flex-row gap-2",children:e.jsx(_e,{id:s.id})})]})})},{Tr:R,Th:Xe,Td:Ze,THead:es,TBody:ss,Sorter:ts}=O,as={paid:"bg-emerald-500",pending:"bg-amber-400"},D=Me(),rs=[D.accessor("id",{header:"Reference",cell:s=>{const t=s.row.original;return e.jsx("div",{children:e.jsx("span",{className:"cursor-pointer",children:t.id})})}}),D.accessor("item",{header:"Product"}),D.accessor("status",{header:"Status",cell:s=>{const t=s.row.original;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(ve,{className:as[t.status]}),e.jsx("span",{className:"ml-2 rtl:mr-2 capitalize",children:t.status})]})}}),D.accessor("date",{header:"Date",cell:s=>{const t=s.row.original;return e.jsx("div",{className:"flex items-center",children:S.unix(t.date).format("MM/DD/YYYY")})}}),D.accessor("amount",{header:"Amount",cell:s=>{const t=s.row.original;return e.jsx("div",{className:"flex items-center",children:e.jsx($,{displayType:"text",value:(Math.round(t.amount*100)/100).toFixed(2),prefix:"$",thousandSeparator:!0})})}})],os=()=>{const s=m(a=>a.crmCustomerDetails.data.paymentHistoryData),[t,l]=h.useState([]),i=Pe({data:s,columns:rs,state:{sorting:t},onSortingChange:l,getCoreRowModel:Se(),getSortedRowModel:we()});return e.jsxs("div",{className:"mb-8",children:[e.jsx("h6",{className:"mb-4",children:"Payment History"}),e.jsxs(O,{children:[e.jsx(es,{children:i.getHeaderGroups().map(a=>e.jsx(R,{children:a.headers.map(r=>e.jsx(Xe,{colSpan:r.colSpan,children:r.isPlaceholder?null:e.jsxs("div",{className:r.column.getCanSort()?"cursor-pointer select-none":"",onClick:r.column.getToggleSortingHandler(),children:[F(r.column.columnDef.header,r.getContext()),e.jsx(ts,{sort:r.column.getIsSorted()})]})},r.id))},a.id))}),e.jsx(ss,{children:i.getRowModel().rows.slice(0,10).map(a=>e.jsx(R,{children:a.getVisibleCells().map(r=>e.jsx(Ze,{children:F(r.column.columnDef.cell,r.getContext())},r.id))},a.id))})]})]})},ls=()=>{const[s,t]=h.useState(!0),l=m(r=>r.crmCustomerDetails.data.subscriptionData),i=h.useCallback(()=>{t(!1)},[]),a=h.useCallback(()=>{t(!0)},[]);return e.jsxs("div",{className:"mb-8",children:[e.jsx("h6",{className:"mb-4",children:"Subscription"}),l.map(r=>e.jsx(V,{bordered:!0,className:"mb-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{children:e.jsx(Y,{className:"bg-emerald-500",shape:"circle",icon:e.jsx(fe,{})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h6",{children:r.plan}),e.jsx(B,{className:"bg-emerald-100 text-emerald-600 dark:bg-emerald-500/20 dark:text-emerald-100 rounded-md border-0 mx-2",children:e.jsx("span",{className:"capitalize",children:r.status})})]}),e.jsxs("div",{children:[e.jsxs("span",{children:["Billing ",r.billing]}),e.jsx("span",{children:" | "}),e.jsxs("span",{children:["Next payment on"," ",S.unix(r.nextPaymentDate).format("MM/DD/YYYY")]}),e.jsxs("span",{children:[e.jsx("span",{className:"mx-1",children:"for"}),e.jsx($,{className:"font-semibold text-gray-900 dark:text-gray-100",displayType:"text",value:(Math.round(r.amount*100)/100).toFixed(2),prefix:"$",thousandSeparator:!0})]})]})]})]}),e.jsxs("div",{className:"flex",children:[s&&e.jsx(u,{size:"sm",variant:"plain",onClick:i,children:"Cancel plan"}),e.jsxs(u,{size:"sm",className:"ml-2 rtl:mr-2",onClick:a,children:[s?"Update":"Subscribe"," Plan"]})]})]})},r.plan))]})},is=Re().shape({cardHolderName:b().required("Card holder name required"),ccNumber:b().required("Credit card number required").matches(/^(?:4[0-9]{12}(?:[0-9]{3})?|[25][1-7][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/,"Invalid credit card number"),cardExpiry:b().required("Card holder name required").matches(/^(0[1-9]|1[0-2])\/?([0-9]{4}|[0-9]{2})$/,"Invalid Date"),code:b().required().matches(/^[0-9]{3}$/,"Invalid CVV")});function A(s,t){return s.length===1&&s[0]>t[0]&&(s="0"+s),s.length===2&&(Number(s)===0?s="01":s>t&&(s=t)),s}function ns(s){const t=A(s.substring(0,2),"12"),l=A(s.substring(2,4),"31");return t+(l.length?"/"+l:"")}const cs=()=>{const s=j(),t=m(o=>o.crmCustomerDetails.data.selectedCard),l=m(o=>o.crmCustomerDetails.data.paymentMethodData),i=m(o=>o.crmCustomerDetails.data.editPaymentMethodDialog),a=m(o=>o.crmCustomerDetails.data.selectedCard),r=o=>{let n=w(l)||[];const{cardHolderName:p,ccNumber:d,cardExpiry:x}=o,v={cardHolderName:p,last4Number:d.substr(d.length-4),expYear:x.substr(x.length-2),expMonth:x.substring(0,2)};n=n.map(g=>(g.last4Number===a.last4Number&&(g={...g,...v}),g)),c(),s(U(n))},c=()=>{s(Be())};return e.jsxs(Ee,{isOpen:i,onClose:c,onRequestClose:c,children:[e.jsx("h4",{children:"Edit Credit Card"}),e.jsx("div",{className:"mt-6",children:e.jsx(Ie,{initialValues:{cardHolderName:t.cardHolderName||"",ccNumber:"",cardExpiry:(t==null?void 0:t.expMonth)+t.expYear||"",code:""},validationSchema:is,onSubmit:(o,{setSubmitting:n})=>{r(o),n(!1)},children:({touched:o,errors:n})=>e.jsx(He,{children:e.jsxs(Fe,{children:[e.jsx(f,{label:"Card holder name",invalid:n.cardHolderName&&o.cardHolderName,errorMessage:n.cardHolderName,children:e.jsx(y,{type:"text",autoComplete:"off",name:"cardHolderName",component:ke})}),e.jsx(f,{label:"Credit Card Number",invalid:n.ccNumber&&o.ccNumber,errorMessage:n.ccNumber,children:e.jsx(y,{name:"ccNumber",children:({field:p,form:d})=>e.jsx(I,{form:d,field:p,placeholder:"•••• •••• •••• ••••",format:"#### #### #### ####",onValueChange:x=>{d.setFieldValue(p.name,x.value)}})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(f,{label:"Expiration date",invalid:n.cardExpiry&&o.cardExpiry,errorMessage:n.cardExpiry,children:e.jsx(y,{name:"cardExpiry",children:({field:p,form:d})=>e.jsx(Te,{form:d,field:p,placeholder:"••/••",format:ns,defaultValue:d.values.cardExpiry,onValueChange:x=>{d.setFieldValue(p.name,x.value)}})})}),e.jsx(f,{label:"CVV",invalid:n.code&&o.code,errorMessage:n.code,children:e.jsx(y,{name:"code",children:({field:p,form:d})=>e.jsx(I,{form:d,field:p,placeholder:"•••",format:"###",onValueChange:x=>{d.setFieldValue(p.name,x.value)}})})})]}),e.jsx(f,{className:"mb-0 text-right",children:e.jsx(u,{block:!0,variant:"solid",type:"submit",children:"Update"})})]})})})})]})},ds=()=>{const s=j(),t=m(c=>c.crmCustomerDetails.data.paymentMethodData),l=m(c=>c.crmCustomerDetails.data.deletePaymentMethodDialog),i=m(c=>c.crmCustomerDetails.data.selectedCard),a=()=>{let c=w(t)||[];c=c.filter(o=>o.last4Number!==i.last4Number),s(H()),s(U(c))},r=()=>{s(H())};return e.jsx(z,{isOpen:l,type:"danger",title:"Remove payment method",confirmButtonColor:"red-600",onClose:r,onRequestClose:r,onCancel:r,onConfirm:a,children:e.jsx("p",{children:" Are you sure you want to remove this payment method? "})})},ms=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],us=()=>{const s=j(),t=m(a=>a.crmCustomerDetails.data.paymentMethodData),l=a=>{s(T(a)),s($e())},i=a=>{s(T(a)),s(qe())};return e.jsxs(e.Fragment,{children:[t.length>0&&e.jsxs("div",{children:[e.jsx("h6",{className:"mb-4",children:"Payment Methods"}),e.jsx("div",{className:"rounded-lg border border-gray-200 dark:border-gray-600",children:t.map((a,r)=>e.jsxs("div",{className:re("flex flex-col lg:flex-row lg:items-center justify-between gap-3 p-4",!Ae(t,r)&&"border-b border-gray-200 dark:border-gray-600"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[a.cardType==="VISA"&&e.jsx("img",{src:"/img/others/img-8.png",alt:"visa"}),a.cardType==="MASTER"&&e.jsx("img",{src:"/img/others/img-9.png",alt:"master"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"text-gray-900 dark:text-gray-100 font-semibold",children:[a.cardHolderName," ••••"," ",a.last4Number]}),a.primary&&e.jsx(B,{className:"bg-sky-100 text-sky-600 dark:bg-sky-500/20 dark:text-sky-100 rounded-md border-0 mx-2",children:e.jsxs("span",{className:"capitalize",children:[" ","Primary"," "]})})]}),e.jsxs("span",{children:["Expired"," ",ms[parseInt(a.expMonth)-1]," ","20",a.expYear]})]})]}),e.jsxs("div",{className:"flex",children:[e.jsx(u,{className:"mr-2 rtl:ml-2",variant:"plain",size:"sm",onClick:()=>i(a),children:"Delete"}),e.jsx(u,{icon:e.jsx(q,{}),size:"sm",onClick:()=>l(a),children:"Edit"})]})]},a.last4Number))})]}),e.jsx(cs,{}),e.jsx(ds,{})]})};oe("crmCustomerDetails",Ge);const ps=()=>{const s=j(),t=le(),l=m(r=>r.crmCustomerDetails.data.profileData),i=m(r=>r.crmCustomerDetails.data.loading);h.useEffect(()=>{a()},[]);const a=()=>{const r=t.get("id");r&&s(M({id:r}))};return e.jsxs(ce,{className:"h-full",children:[e.jsx(ie,{loading:i,children:!E(l)&&e.jsxs("div",{className:"flex flex-col xl:flex-row gap-4",children:[e.jsx("div",{children:e.jsx(Ke,{data:l})}),e.jsx("div",{className:"w-full",children:e.jsxs(ne,{children:[e.jsx(ls,{}),e.jsx(os,{}),e.jsx(us,{})]})})]})}),!i&&E(l)&&e.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[e.jsx(de,{src:"/img/others/img-2.png",darkModeSrc:"/img/others/img-2-dark.png",alt:"No user found!"}),e.jsx("h3",{className:"mt-8",children:"No user found!"})]})]})},rt=ps;export{rt as default};
